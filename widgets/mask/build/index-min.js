/*! mask 2013-11-28 03:06:55 */
KISSY.add("mask/index",function(a,b){function c(){this.initMask.apply(this,arguments)}var d=$(document.documentElement);c.ATTRS={useAnim:{},duration:{value:200},easing:{value:"linear"},zIndex:{value:100},visible:{value:!1},opacity:{value:"0.7"},maskClass:{value:""},disableScroll:{value:!0},clickHide:{value:!0},maskParent:{value:"body"},position:{value:"fixed"}},a.augment(c,{initMask:function(){},destroyMask:function(){this.mask&&(this.mask.off().remove(),delete this.mask)},renderMask:function(a){var b=$('<div class="m-mask m-mask-hidden"></div>'),c=this.get("maskClass"),d=Number(this.get("zIndex")),e=this.get("position"),f=this.constructor.CSS_PREFIX;return c&&b.addClass(c),f&&b.addClass("m-"+f+"-mask"),b.css({position:e,width:"100%",height:"100%",left:"0",top:"0",opacity:"0",display:"none","z-index":d-1}),$(this.get("maskParent")).append(b),this.mask=b,a&&this.bindMask(),this},bindMask:function(){var a=this.get("clickHide");return this.on("afterVisibleChange",this._afterMaskVisibleChange),this.on("showMask",this._showMask),this.on("hideMask",this._hideMask),a&&this.mask.on("click",$.proxy(this.hideMask,this)),this},syncMask:function(){},showMask:function(a){return this.set("visible",!0,{data:{useAnim:a}}),this},hideMask:function(a){return this.set("visible",!1,{data:{useAnim:a}}),this},disableScroll:function(){d.on("touchmove",this._preventScroll)},enableScroll:function(){d.on("touchmove",this._preventScroll)},_getMaskCssCfg:function(a){return{opacity:a?this.get("opacity"):0}},_showMask:function(a){this.mask||this.renderMask(),this._uiMaskChange(1,a)},_hideMask:function(a){this.mask&&this._uiMaskChange(0,a)},_uiMaskChange:function(a,b){function c(){!a&&d.mask.css("display","none"),d.fire(a?"showMaskEnd":"hideMaskEnd",{useAnim:e})}var d=this,e=b.useAnim,f=this._getMaskCssCfg(a),g=this.get("duration"),h=this.get("easing");a&&d.mask.css("display","block"),d.mask.toggleClass("m-mask-hidden",!a),e?this.mask.animate(f,g,h,c):(this.mask.css(f),c())},_preventScroll:function(a){a.preventDefault()},_afterMaskVisibleChange:function(a){var b=this.get("useAnim");a.useAnim=b===!1?!1:a.useAnim===!1?!1:!0,this.fire(a.newVal?"showMask":"hideMask",{useAnim:a.useAnim})}});var e='<div class="m-mask-content"></div>',f=b.extend([c],{show:function(a){return this.showMask(a)},hide:function(a){return this.hideMask(a)},render:function(){return this.renderMask(!0),this._renderContent(),this},destructor:function(){return this.destroyMask()},_renderContent:function(){var a=this.get("content");a&&(this.content=$(e),this.content.append(a),this.mask.append(this.content),this._bindContent())},_bindContent:function(){var a=this.get("clickHide");this.content.on("click",function(b){a&&b.stopPropagation()})}},{ATTRS:{content:{}}});return f.Ext=c,f},{requires:["base"]});